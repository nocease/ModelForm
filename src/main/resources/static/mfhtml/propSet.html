<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" href="../lib/layui/css/layui.css"/>
    <link rel="stylesheet" href="../lib/pretty-checkbox.css">
    <script src="../lib/layui/layui.all.js" type="text/javascript" charset="utf-8"></script>
    <script src="../lib/axios.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/public.js" type="text/javascript" charset="utf-8"></script>
</head>
<style>
    body {
        margin: 50px 100px 0 100px;
    }
</style>
<body>
<div id="app">
    <div class="layui-collapse" lay-accordion>
        <div class="layui-colla-item">
            <h2 class="layui-colla-title">腾讯Al接入</h2>
            <div class="layui-colla-content layui-show">
                <table class="layui-table">
                    <colgroup>
                        <col width="150">
                        <col>
                    </colgroup>
                    <thead>
                    <tr>
                        <td colspan="2">
                            申请地址：<a style="color: black" href="https://ai.qq.com/" target="_blank">腾讯Al开放平台</a>
                        </td>
                    </tr>
                    </thead>
                    <tbody>

                    <tr>
                        <td>APPID</td>
                        <td>
                            <input id="tencent1" type="text" placeholder="请输入腾讯Al开放平台的APPID：" class="layui-input"
                                   autocomplete="off"/>
                        </td>
                    </tr>
                    <tr>
                        <td>APPKEY</td>
                        <td>
                            <input id="tencent2" type="text" placeholder="请输入腾讯Al开放平台的APPKEY：" class="layui-input"
                                   autocomplete="off"/>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="layui-colla-item">
            <h2 class="layui-colla-title">对象储存</h2>
            <div class="layui-colla-content">
                <div style="width: 100px;height: 1px"></div>
                <div class="pretty p-icon p-round">
                    <input type="radio" name="icon_solid" id="check0" value="0"/>
                    <div class="state p-success">
                        <i class="icon mdi mdi-check"></i>
                        <label>使用对象储存</label>
                    </div>
                </div>
                <div class="pretty p-icon p-round">
                    <input type="radio" name="icon_solid" id="check1" value="1"/>
                    <div class="state p-success">
                        <i class="icon mdi mdi-check"></i>
                        <label>使用独立文件系统</label>
                    </div>
                </div>
                <table class="layui-table">
                    <colgroup>
                        <col width="150">
                        <col>
                    </colgroup>
                    <thead>
                    <tr>
                        <td colspan="2">
                            申请地址：<a style="color: black" href="https://portal.qiniu.com/kodo/overview" target="_blank">七牛云-对象存储</a>
                        </td>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>accessKey</td>
                        <td>
                            <input id="accessKey" type="text" placeholder="请输入对象存储accessKey：" class="layui-input"
                                   autocomplete="off"/>
                        </td>
                    </tr>
                    <tr>
                        <td>secretKey</td>
                        <td>
                            <input id="secretKey" type="text" placeholder="请输入对象存储secretKey：" class="layui-input"
                                   autocomplete="off"/>
                        </td>
                    </tr>
                    <tr>
                        <td>bucket</td>
                        <td>
                            <input id="bucket" type="text" placeholder="请输入存储空间名称：" class="layui-input"
                                   autocomplete="off"/>
                        </td>
                    </tr>
                    <tr>
                        <td>domain</td>
                        <td>
                            <input id="domain" type="text" placeholder="请输入CDN加速域名、协议（格式：http://a.com/）"
                                   class="layui-input"
                                   autocomplete="off"/>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <table class="layui-table">
                    <colgroup>
                        <col width="150">
                        <col>
                    </colgroup>
                    <thead>
                    <tr>
                        <td colspan="2">
                            格式要求：<a onclick="tipJSON()" style="color: black" href="#">返回参数说明</a>
                        </td>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>文件提交接口：</td>
                        <td>
                            <input id="upurl" type="text" placeholder="请输入对象存储accessKey：" class="layui-input"
                                   autocomplete="off"/>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="layui-colla-item">
            <h2 class="layui-colla-title">短信推送</h2>
            <div class="layui-colla-content">
                <table class="layui-table">
                    <colgroup>
                        <col width="150">
                        <col>
                    </colgroup>
                    <thead>
                    <tr>
                        <td colspan="2">
                            申请地址：<a style="color: black" href="https://console.cloud.tencent.com/smsv2" target="_blank">腾讯云-短信推送</a>
                        </td>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>appid</td>
                        <td>
                            <input id="sms1" type="text" placeholder="请输入appid：" class="layui-input"
                                   autocomplete="off"/>
                        </td>
                    </tr>
                    <tr>
                        <td>appkey</td>
                        <td>
                            <input id="sms2" type="text" placeholder="请输入appkey：" class="layui-input"
                                   autocomplete="off"/>
                        </td>
                    </tr>
                    <tr>
                        <td>templateId</td>
                        <td>
                            <input id="sms3" type="text" placeholder="请输入短信模板ID：" class="layui-input"
                                   autocomplete="off"/>
                        </td>
                    </tr>
                    <tr>
                        <td>smsSign</td>
                        <td>
                            <input id="sms4" type="text" placeholder="请输入短信签名：" class="layui-input" autocomplete="off"/>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="layui-colla-item">
            <h2 class="layui-colla-title">邮件推送</h2>
            <div class="layui-colla-content">
                <table class="layui-table">
                    <colgroup>
                        <col width="150">
                        <col>
                    </colgroup>
                    <thead>
                    <tr>
                        <td colspan="2">
                            设置系统发件人的账户密码：
                        </td>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>系统邮箱账户</td>
                        <td>
                            <input id="mail1" type="text" placeholder="请输入系统邮箱账户：" class="layui-input"
                                   autocomplete="off"/>
                        </td>
                    </tr>
                    <tr>
                        <td>系统邮箱密码</td>
                        <td>
                            <input id="mail2" type="text" placeholder="请输入系统邮箱密码："
                                   class="layui-input" autocomplete="off"/>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="layui-colla-item">
            <h2 class="layui-colla-title">主题设置</h2>
            <div class="layui-colla-content">
                <table class="layui-table">
                    <colgroup>
                        <col width="150">
                        <col>
                    </colgroup>
                    <thead>
                    <tr>
                        <td>
                            选择主题：
                        </td>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>
                            <div class="pretty p-icon p-curve p-jelly">
                                <input type="radio" name="radio66" value="false" id="defaultTheme"/>
                                <div class="state p-warning">
                                    <i class="icon mdi mdi-check"></i>
                                    <label>默认主题</label>
                                </div>
                            </div>
                            <div class="pretty p-icon p-curve p-jelly">
                                <input type="radio" name="radio66" value="true" id="darkTheme"/>
                                <div class="state p-warning">
                                    <i class="icon mdi mdi-check"></i>
                                    <label>深色模式</label>
                                </div>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="layui-colla-item">
            <h2 class="layui-colla-title">初始化数据库</h2>
            <div class="layui-colla-content">
                <table class="layui-table">
                    <colgroup>
                        <col width="150">
                        <col>
                    </colgroup>
                    <thead>
                    <tr>
                        <td>
                            初始化数据库：
                        </td>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>
                            <button onclick="InitializeDatabase()" class="layui-btn">
                                <i class="layui-icon">&#xe639;</i> 初始化数据库
                            </button>
                            <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注：将自动生成所需的数据库表及表结构。当前已有数据将丢失，建议在空数据库下执行。</span>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="layui-colla-item">
            <h2 class="layui-colla-title">禁用开发</h2>
            <div class="layui-colla-content">
                <table class="layui-table">
                    <colgroup>
                        <col width="150">
                        <col>
                    </colgroup>
                    <thead>
                    <tr>
                        <td>
                            禁用开发：
                        </td>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>
                            <div class="pretty p-image p-plain">
                                <input type="checkbox" id="dev" name="dev"/>
                                <div class="state">
                                    <img class="image" src="/img/close.png">
                                    <label>禁用开发。禁用后仅能访问生成的用户页面，可防止用户进入开发页面</label>
                                </div>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div style="height: 20px"></div>
    <div align="center">
        <button onclick="parent.layer.close(parent.layer.getFrameIndex(window.name))"
                class="layui-btn layui-btn-danger">
            <i class="layui-icon">&#x1006;</i> 关闭
        </button>
        <button onclick="location.reload()" class="layui-btn layui-btn-normal">
            <i class="layui-icon">&#xe666;</i> 刷新
        </button>
        <button onclick="keep()" type="button" class="layui-btn">
            <i class="layui-icon">&#xe605;</i> 保存
        </button>
    </div>
    <div style="height: 20px"></div>
</div>
</body>
<script>
    eval('layui.element.render(\'layui-collapse\');');
    axios.get('/prop/getProp').then(res => {
        var JSON = res.data;
        document.getElementById('mail1').value = JSON.mail.mailUser;
        document.getElementById('mail2').value = JSON.mail.mailPassword;
        document.getElementById('sms1').value = JSON.sms.appid;
        document.getElementById('sms2').value = JSON.sms.appkey;
        document.getElementById('sms3').value = JSON.sms.templateId;
        document.getElementById('sms4').value = JSON.sms.smsSign;
        document.getElementById('tencent1').value = JSON.tencent.APPID;
        document.getElementById('tencent2').value = JSON.tencent.APPKEY;
        document.getElementById('upurl').value = JSON.file_system.upURL;
        document.getElementById('accessKey').value = JSON.file_system.accessKey;
        document.getElementById('secretKey').value = JSON.file_system.secretKey;
        document.getElementById('bucket').value = JSON.file_system.bucket;
        document.getElementById('domain').value = JSON.file_system.domain;
        if (JSON.file_system.upURL == '/pageAddSet/upToQiniu') {
            //选中
            $('#check0').prop("checked", true);
            $('#check1').prop("checked", false);
        } else {
            $('#check1').prop("checked", true);
            $('#check0').prop("checked", false);
        }
        if (JSON.theme == "true") {
            $('#darkTheme').prop("checked", true);
        } else if (JSON.theme == "false") {
            $('#defaultTheme').prop("checked", true);
        }
        if (JSON.dev == "true") {
            $('#dev').prop("checked", false);
        } else if (JSON.dev == "false") {
            $('#dev').prop("checked", true);
        }
    }).catch(err => {
        alert("错误：" + JSON.stringify(err));
    });

    function tipJSON() {
        layer.open({
            type: 1,
            content: '<img src="../lib/layui/images/jsonType.png" width="100%"/>',
            title: '返回json格式要求：',
            shadeClose: true,
            anim: getRandom(0, 6),
            area: ['300px', '200px']
        });
    }

    $("#upurl").attr("disabled", true);
    $('input[type=radio][name=icon_solid]').change(function () {
        if (this.value == '0') {
            $("#upurl").attr("disabled", true);
            $("#upurl").val('/pageAddSet/upToQiniu');
            $("#accessKey").attr("disabled", false);
            $("#secretKey").attr("disabled", false);
            $("#bucket").attr("disabled", false);
            $("#domain").attr("disabled", false);
        } else if (this.value == '1') {
            $("#upurl").attr("disabled", false);
            $("#upurl").val('http://fastdfs.jinxv.cn/');
            $("#accessKey").attr("disabled", true);
            $("#secretKey").attr("disabled", true);
            $("#bucket").attr("disabled", true);
            $("#domain").attr("disabled", true);
        }
    });

    //提交保存
    function keep() {
        var theme = $("input[name='radio66']:checked").val();
        if ($('#dev').is(":checked"))
            var dev = false; else dev = true;
        var mail = {
            mailUser: $('#mail1').val(),
            mailPassword: $('#mail2').val()
        };
        var sms = {
            appid: $('#sms1').val(),
            appkey: $('#sms2').val(),
            templateId: $('#sms3').val(),
            smsSign: $('#sms4').val()
        };
        var tencent = {
            APPID: $('#tencent1').val(),
            APPKEY: $('#tencent2').val()
        };
        var file_system = {
            upURL: $('#upurl').val(),
            accessKey: $('#accessKey').val(),
            secretKey: $('#secretKey').val(),
            bucket: $('#bucket').val(),
            domain: $('#domain').val()
        };
        var json = {mail, sms, tencent, file_system, theme, dev};
        axios({
            method: 'post',
            url: '/prop/keepProp',
            data: JSON.stringify(json),
            headers: {"Content-Type": "application/json"}
        }).then(res => {
            alert("保存成功，已实时生效！", {icon: 1}, function () {
                parent.location.reload();
            });
        }).catch(err => {
            alert("遇到了错误：" + JSON.stringify(err), {icon: 2})
        });
    }


    //初始化数据库
    function InitializeDatabase() {
        layer.confirm("将重新建表。<br>已有数据将丢失，请谨慎操作！", {icon: 0}, function () {
            axios.get("/doSQL/InitializeDatabase").then(res => {
                alert("已执行!", function () {
                    location.reload();
                });
            }).catch(err => {
                alert("命令已提交，请检查是否成功。")
            });
        })
    }
</script>
</html>